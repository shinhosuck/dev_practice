{% extends 'tweets/index.html' %}



<title>
    {% block title %}
        Home
    {% endblock title %}
</title>



{% block content %}
    <style>
        .home-container {
            width: 90%;
            margin: 0 auto;
            padding: 8rem 0 3rem 0;
        }
        .home-header {
            text-align: center;
            letter-spacing: 0.06rem;
            padding: 1rem;
            color: gray
        }
        .tweet-form-wrapper {
            display: flex;
            justify-content: center;
            align-items: center; 
        }
        #tweet-form {
            width: 500px;
        }
        form > input, textarea {
            display: block;
            width: 100%;
            margin-bottom: 0.5rem;
            padding: 1rem;
            border-radius: 5px;
            border: 1px solid gray;
            letter-spacing: 0.06rem;
            resize: none;
        }
        .tweet-btn-wrapper {
            display: flex;
            justify-content: flex-end;
            margin-top: 0.5rem
        }
        .tweet-wrapper {
            border: 2px solid lightgray;
            padding: 1.2rem;
            border-radius: 10px;
            border: 2px solid blueviolet;
            width: 900px;
            margin: 0 auto;
            margin-top: 0.5rem;
            letter-spacing: 0.06rem;
        }
        .tweet-wrapper > p {
            padding: 0.5rem 0;
        }
        .tweet-wrapper > p:nth-child(2) {
            color: rgb(51, 51, 51);
            font-size: 1.3rem;
        }
        .tweet-wrapper > p:nth-child(3) {
            color: gray;
            line-height: 1.5;
        }
        .tweet-wrapper > div > a {
            display: inline-block;
            border: 1px solid lightblue;
            padding: 0.5rem 0.8rem;
            border-radius: 5px;
        }
        .tweet-wrapper > div > a:nth-child(1) {
            color: blue;
        }
        .tweet-wrapper > div > a:nth-child(2) {
            color: rgb(255, 102, 0);
        }
        .tweet-wrapper > div > a:nth-child(3) {
            color: rgb(183, 0, 255);
        }
        @media screen and (max-width: 500px) {
            /* #tweet-form {
                width: 100%;
            } */
        }
    </style>
    <div class="home-container">
        <div class="home-header">
            <h1>Welcome to TWEETclone!</h1>
        </div>
        <div class="tweet-form-wrapper">
            <form id='tweet-form' action="{% url 'tweets:new-tweet' %}" method="POST">
                {% csrf_token %}
                <input type="hidden" value="{% url 'tweets:home' %}" name="next">
                <input type="text" name="title" placeholder="Title">
                <textarea name="content" id="" cols="" rows="10" placeholder="Your tweet..."></textarea>
                <div class="tweet-btn-wrapper">
                    <button id="tweet-btn">tweet</button>
                </div>
            </form>
        </div>

        <div id="tweets-container">
            <!-- tweets go here -->
        </div>
    </div>





    <script type="text/javascript">
        let tweetsContainer = document.querySelector('#tweets-container')
        const tweetForm = document.querySelector('#tweet-form')
        
        

        tweetForm.addEventListener('submit', function(event){
            event.preventDefault()
            const form = event.target
            const formData =  new FormData(form)
            const method = form.getAttribute('method')
            const url = form.getAttribute('action')
            const xhr = new XMLHttpRequest()
            const responseType = 'json'

            xhr.responseType = responseType
            xhr.open(method, url)
            xhr.setRequestHeader('HTTP_X_REQUESTED_WITH', 'XMLHttpRequest')
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest')
            xhr.onload = function(){
                // console.log(xhr.response)
                let tweetsInnerHtml = tweetsContainer.innerHTML
                let newTweet = xhr.response
                let newTweetDiv = `<div class='tweet-wrapper'>
                                    <p>Tweet:${newTweet.id}</p>
                                    <p>${newTweet.title}</p>
                                    <p>${newTweet.content}</p>
                                    <div>
                                        <a href="#">Reply</a>
                                        <a href="#">0 like</a> 
                                        <a href="#">0 following</a>
                                    </div>
                                </div>`
                
                tweetsContainer.innerHTML = newTweetDiv + tweetsInnerHtml
                tweetForm.reset()
                // loadTweets()
            }
            xhr.send(formData)

        })


        const loadTweets = function(){
            const xhr = new XMLHttpRequest()
            const method = 'GET'
            const url = '{% url "tweets:tweets" %}'
            const responseType = 'json'

            xhr.responseType = responseType
            xhr.open(method, url)
            xhr.onload = function(){
                let totalTweets = ''
                let serverData = [...xhr.response.tweets] 
                serverData.forEach(function(data){
                    let tweet = `<div class='tweet-wrapper'>
                                    <p>Tweet: ${data.id}</p>
                                    <p>${data.title}</p>
                                    <p>${data.content}</p>
                                    <div>
                                        <a href="#">Reply</a>
                                        <a href="#">${data.likes} likes</a> 
                                        <a href="#">${data.follow} following</a>
                                    </div>
                                </div>`
                totalTweets += tweet
                })
                tweetsContainer.innerHTML = totalTweets
            }
            xhr.send()
        }
        loadTweets()
    </script>
{% endblock content %}